<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd"> 

<mapper namespace="com.vinflux.mobile.ems.catalog">
	<parameterMap id="parameterMap" type="java.util.HashMap" />
 	<resultMap id="resultMap" type="java.util.HashMap" />
	
	
	<select id="SelectMainCollectionItem" parameterMap="parameterMap" resultMap="resultMap">
		<![CDATA[
			SELECT A.CTKEY
			     , A.CATLID
			     , A.CATLNAME
			     , A.YEAR
			     , (SELECT B.ADCD_DTNAME
			          FROM ADMIN.TADMIN_MST_ADCD_DT B
			         WHERE B.ADCD_HDKEY   = 'SEASON'
			           AND B.ADCD_DTVALUE = A.SEASON
			           AND B.LAKEY        = #{LAKEY}
			         ) AS SEASON
			     , A.SEASON
			     , A.ISDISPLAY
			     , (SELECT C.IMGURL
			          FROM TSE_INFO_CATL_IMG C
			         WHERE C.CATLID     = A.CATLID
			           AND C.RPRIMGFLAG = 'Y'
			         ) AS IMGURL
			     , A.DISSTARTDATE
			     , A.DISENDDATE
			  FROM TSE_INFO_CATL_HD A
			 WHERE A.ISDISPLAY = 'Y'		
			   AND ROWNUM = 1
			 ORDER BY A.INSERTDATE DESC
 		]]>	 
	</select>
	
	
	<select id="SelectCollectionInfoList" parameterMap="parameterMap" resultMap="resultMap">
		<![CDATA[
			SELECT A.CTKEY
			     , A.CATLID
			     , A.CATLNAME
			     , A.YEAR
			     , (SELECT B.ADCD_DTNAME
			          FROM ADMIN.TADMIN_MST_ADCD_DT B
			         WHERE B.ADCD_HDKEY   = 'SEASON'
			           AND B.ADCD_DTVALUE = A.SEASON
			           AND B.LAKEY        = #{LAKEY}
			         ) AS SEASON
			     , A.SEASON
			     , A.ISDISPLAY
			     , (SELECT C.IMGURL
			          FROM TSE_INFO_CATL_IMG C
			         WHERE C.CATLID     = A.CATLID
			           AND C.RPRIMGFLAG = 'Y'
			         ) AS IMGURL
			     , A.DISSTARTDATE
			     , A.DISENDDATE
			  FROM TSE_INFO_CATL_HD A
			 WHERE A.ISDISPLAY = 'Y'			
 		]]>	 
	</select>
	
	<select id="SelectCollectionItemInfo" parameterMap="parameterMap" resultMap="resultMap">
		<![CDATA[
			SELECT A.FILEID
			     , A.CATLID
			     , A.IMGSEQ
			     , A.RPRIMGFLAG
			     , A.DISPLAYORD
			     , A.ISDISPLAY
			     , A.IMGURL
			     , A.IMGTYPE
			  FROM TSE_INFO_CATL_IMG A
			 WHERE A.CATLID = #{CATLID}
	  	     ORDER BY CAST(A.IMGSEQ As Int)  ASC
 		]]>	 
	</select>
	
	<select id="SelectCollectionDetailItemInfo" parameterMap="parameterMap" resultMap="resultMap">
		<![CDATA[
			SELECT DISTINCT
			       A.CTKEY
			     , A.OWKEY
			     , A.RPRICKEY
			     , B.ICNAME
			     , A.BRANDCODE
			       , NVL(A.SALEPRICE, '0') AS SALEPRICE
			     , NVL(A.COSTPRICE, '0') AS COSTPRICE
			     , NVL(A.DISRATE  , '0') AS DISRATE
			     , NVL(A.SAVMONEY , '0') AS SAVMONEY
			  
			     , NVL(
			          (SELECT DISTINCT
			                  SUBSTR(XMLAGG(XMLELEMENT("COLOR", ','||C.COLOR) ORDER BY C.COLOR ).EXTRACT('//text()'), 2) AS COLOR
			             FROM TWORK_MST_IC_HD C
			            WHERE C.RPRICKEY = A.RPRICKEY), 'NONE') AS COLOR
			     
			     , NVL(
			        (SELECT DISTINCT
			                SUBSTR(XMLAGG(XMLELEMENT("ISIZE", ','||C.ISIZE) ORDER BY C.ISIZE ).EXTRACT('//text()'), 2) AS ISIZE
			             FROM TWORK_MST_IC_HD C
			            WHERE C.RPRICKEY = A.RPRICKEY), 'NONE') AS ISIZE
			         
			     , NVL(
			          (SELECT C.IMGURL
			             FROM TWORK_MST_IC_IMG C
			            WHERE C.RPRICKEY = A.RPRICKEY 
			              AND C.IMGSEQ   = '1'), 'NONE') AS MAIN_IMAGE   
			            
			      , NVL(
			           (SELECT SUBSTR(XMLAGG(XMLELEMENT("IMGURL", ','||C.IMGURL) ORDER BY C.IMGURL ).EXTRACT('//text()'), 2) AS IMGURL
			             FROM TWORK_MST_IC_IMG C
			            WHERE C.RPRICKEY = A.RPRICKEY 
			              AND C.IMGSEQ  <> '1'), 'NONE') AS DETAIL_IMAGE   
			
			     , A.INSERTDATE
			     FROM TWORK_MST_IC_HD     A
			        , TWORK_MST_IC_DT     B
			        , TSE_INFO_CATL_IMG   C
			        , TSE_INFO_CATL_ITEM  D
			    WHERE A.ICKEY    = B.ICKEY
			      AND C.FILEID   = D.FILEID
			      AND A.RPRICKEY = D.RPRICKEY
			      AND C.FILEID   = #{FILEID}
 		]]>	 
	</select>
	


</mapper>